<html>
    <head>
        <script type="text/javascript" src="../../../main/webapp/js/mootools-release-1.11.js"> </script>
        <script type="text/javascript">
            function addPref(prefCount) {
                var prefsUL = $('prefs');
                var prefCount = prefsUL.getChildren().length / 2;
                
                //Setup the Name/Add Value LI
                var nameLI = new Element('li');
                nameLI.injectInside(prefsUL);
                
                var nameINPUT = new Element('input', { 
                    'type' : 'text', 
                    'name' : 'preferences[' + prefCount + '].name' 
                }); 
                nameINPUT.injectInside(nameLI);
                
                nameLI.appendText(" ");
                
                var addValueA = new Element('a', { 
                    'href' : 'javascript:void(0)',
                    'onclick' : 'addValue(' + prefCount + '); return false;'
                });
                addValueA.setText("Add Value");
                addValueA.injectInside(nameLI);
                
                
                //Setup the values LI
                var valuesLI = new Element('li');
                valuesLI.injectInside(prefsUL);
                
                var valuesUL = new Element('ul', { 
                    'id' : 'pref_vals_' + prefCount, 
                    'style' : 'list-style: none; padding-top: 0px; padding-bottom: 10px;'
                }); 
                valuesUL.injectInside(valuesLI);
                
                return false;
            }
            
            function addValue(prefIndex) {
                var valuesUL = $('pref_vals_' + prefIndex);
                var valueCount = valuesUL.getChildren().length;

                var valueLI = new Element('li', { 
                    'id' : 'pref_val_' + prefIndex + '_' + valueCount 
                });
                valueLI.injectInside(valuesUL);
                
                var valueINPUT = new Element('input', { 
                    'type' : 'text', 
                    'name' : 'preferences[' + prefIndex + '].values[' + valueCount + ']' 
                }); 
                valueINPUT.injectInside(valueLI);
                
                return false;
            }
        </script>
    </head>
    <body>
        <ul id="prefs" style="list-style: none;">
            <li><input type="text" name="preferences[0].name" value="Pref 1" /> <a href="javascript:void(0)" onclick="addValue(0); return false;">Add Value</a></li>
            <li>
                <ul id="pref_vals_0" style="list-style: none; padding-top: 0px; padding-bottom: 10px;">
                    <li id="pref_val_0_0"><input type="text" name="preferences[0].values[0]" value="Value 1.1" /></li>
                    <li id="pref_val_0_1"><input type="text" name="preferences[0].values[1]" value="Value 1.2" /></li>
                </ul>
            </li>
            <li><input type="text" name="preferences[0].name" value="Pref 2" /> <a href="javascript:void(0)" onclick="addValue(1); return false;">Add Value</a></li>
            <li>
                <ul id="pref_vals_1" style="list-style: none; padding-top: 0px; padding-bottom: 10px;">
                </ul>
            </li>
        </ul>
        <a href="javascript:void(0)" onclick="addPref(); return false;">Add Preference</a>
    </body>
</html>